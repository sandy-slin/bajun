# A股板块分析系统需求文档

## 更新日期: 2025-01-15

## 新增功能需求: 板块走势分析

### 核心功能
在现有个股分析基础上，新增板块级别的综合分析功能:

1. **板块筛选功能**: 基于板块轮动规律，筛选未来1-2周最值得跟踪的前5个板块
2. **历史板块分析**: 分析过去某天或某一段时间的A股板块走势  
3. **预测分析**: 基于历史信息分析未来3天的板块走势
4. **回测验证功能**: 使用历史数据验证预测准确性，持续优化筛选算法

### 技术规格

#### 行业分类标准
- **推荐使用**: 申万行业分类(31个一级行业)
- **理由**: 更贴合中国国情，从投资研究角度设计，AKShare支持完善
- **数据覆盖**: 银行、非银金融、房地产、食品饮料、家用电器、医药生物、电子、计算机、通信、机械设备、电力设备、汽车等

#### 时间范围处理
- **默认值**: 最近一周(7个自然日)
- **输入格式**: `from YYMMDD to YYMMDD`
- **示例**:
  - `from 241210 to 241216`(2024年12月10日到16日)
  - `from 231225 to 240105`(跨年场景)
- **边界处理**:
  - 自动调整到交易日
  - 最大范围: 6个月
  - 最小范围: 1个交易日

#### 数据源策略
- **主要方案**: 混合使用AKShare + BaoStock
- **AKShare**: 专长申万行业分类、板块实时数据
- **BaoStock**: 专长历史K线、成交量、换手率等技术指标
- **备选方案**: 如发现更优免费数据源可灵活替换

#### 分析维度
1. **价格走势分析**
   - 板块指数涨跌幅(日、周、月)
   - 技术指标: MA均线、RSI、MACD
   - 波动率分析

2. **个股表现分析**
   - 板块内领涨/领跌个股Top 10
   - 个股涨跌幅分布
   - 活跃股票识别(成交额前20)

3. **成交量分析**
   - 板块总成交量变化
   - 量价关系分析
   - 换手率统计

4. **资金流向分析**
   - 主力资金净流入/流出
   - 大单净量比
   - 板块资金流向排名

### 板块筛选评分体系
基于A股板块轮动规律，设计多维度评分模型:

#### 核心筛选指标
1. **技术面强度评分(40%权重)**
   - 相对强弱指数(RSI-14): 40-70区间为强势突破区
   - 板块相对沪深300强弱比: 连续5日跑赢大盘加分
   - 突破信号: 突破60日均线且成交量放大2倍以上
   - MACD金叉: 在0轴附近或以上形成金叉

2. **资金流向评分(30%权重)**
   - 主力净流入: 连续3日主力资金净流入
   - 北向资金: 近5日北向资金持续加仓板块
   - 融资余额增长: 板块融资余额增长率>5%
   - 大单净量比: >20%视为强势

3. **基本面景气度(20%权重)**
   - 政策催化: 国家政策支持、行业利好消息
   - 业绩预期: 板块内龙头股业绩预增>30%
   - 估值修复: PE低于历史分位数30%以下
   - 机构关注度: 近期调研频次增加

4. **轮动周期判断(10%权重)**
   - 历史轮动周期: 基于过去2年轮动数据预测
   - 板块生命周期: 判断是否处于启动期或成长期
   - 市场情绪: 板块热度和关注度变化

#### 筛选算法
- 综合评分 = Σ(指标得分 × 权重)
- Top 5板块: 评分前5名且综合得分>75分
- 动态调整: 每日更新评分，周末输出推荐清单

### 回测验证体系
基于历史数据验证预测准确性，形成持续优化闭环:

#### 验证逻辑
1. **历史模拟**: 使用T-N天历史数据预测T天后的板块表现
2. **实际对比**: 获取T天后的真实数据进行准确率验证
3. **策略优化**: 基于验证结果调整筛选权重和阈值
4. **持续迭代**: 形成自我学习和优化的闭环

#### 验证指标体系
1. **预测准确率指标**
   - 板块排名准确率: Top5预测板块中实际表现进入前10的比例
   - 涨跌方向准确率: 预测涨跌方向与实际一致的比例  
   - 幅度偏差率: 预测涨跌幅与实际偏差的平均值
   - 夏普比率: 基于预测的投资组合风险调整收益

2. **细分验证指标**
   - 技术面指标准确率: RSI、MACD等技术指标预测准确性
   - 资金流向预测率: 资金净流入预测与实际对比
   - 轮动周期吻合度: 板块轮动时机预测准确性
   - 政策催化命中率: 基本面政策影响预测准确性

#### 算法优化机制
1. **动态权重调整**
   - 表现评估: 每月评估各指标实际预测效果
   - 权重优化: 基于准确率动态调整技术面(40%)、资金面(30%)等权重
   - 阈值优化: 根据历史回测结果调整评分阈值

2. **机器学习集成**
   - 特征重要性: 识别对预测结果影响最大的特征
   - 参数调优: 基于历史数据优化RSI区间、MA周期等参数
   - 模型集成: 结合多种算法模型提升预测准确性

3. **市场环境适应**
   - 牛熊市切换: 不同市场环境下调整策略权重
   - 波动率适应: 高波动期降低技术指标权重
   - 政策周期: 重大政策期间提升基本面权重

### 命令行接口设计
```bash
# 板块筛选(推荐Top5值得跟踪的板块)
python src/main.py --sector-screening --period "1-2weeks"

# 回测验证(验证历史预测准确性)
python src/main.py --backtest --start-date "240101" --end-date "241201" --validation-period "2weeks"

# 算法优化(基于回测结果优化参数)
python src/main.py --optimize-model --backtest-period "6months"

# 板块分析(使用默认一周时间范围)
python src/main.py --sector-analysis --sector 医药生物

# 板块分析(自定义时间范围)
python src/main.py --sector-analysis --sector 银行 --time-range "from 241210 to 241216"

# 显示支持的板块列表
python src/main.py --list-sectors

# 批量分析多个板块
python src/main.py --sector-analysis --sector 医药生物,银行,电子
```

### 报告输出格式

#### 板块筛选报告
- **存储路径**: `reports/screening/`
- **文件命名**: `sector_screening_{YYYYMMDD}_{HHMMSS}.md`
- **内容结构**:
  1. Top5推荐板块及评分
  2. 各板块技术面、资金面、基本面分析
  3. 轮动周期判断和历史对比
  4. 选股策略建议
  5. 风险提示和止损建议

#### 单板块分析报告  
- **存储路径**: `reports/sector/`
- **文件命名**: `{sector_name}_{YYYYMMDD}_{HHMMSS}.md`
- **内容结构**:
  1. 板块概览和时间范围
  2. 价格走势分析
  3. 个股表现排名
  4. 成交量和资金流向分析
  5. 未来3天走势预测
  6. 投资建议和风险提示

#### 回测验证报告
- **存储路径**: `reports/backtest/`
- **文件命名**: `backtest_report_{start_date}_{end_date}_{HHMMSS}.md`
- **内容结构**:
  1. 回测周期和参数设置
  2. 预测准确率统计(排名、方向、幅度)
  3. 各指标分项准确率分析
  4. 策略收益率与基准对比
  5. 权重优化建议
  6. 模型改进方向

#### 模型优化报告
- **存储路径**: `reports/optimization/`  
- **文件命名**: `model_optimization_{YYYYMMDD}_{HHMMSS}.md`
- **内容结构**:
  1. 优化前后参数对比
  2. 准确率提升统计
  3. 各指标权重调整记录
  4. 市场环境适应性分析
  5. 下阶段优化计划

### 架构扩展要求
- **模块化设计**: 
  - 新增`src/analysis/sector_analyzer.py` (单板块分析)
  - 新增`src/analysis/sector_screener.py` (板块筛选)
  - 新增`src/analysis/backtest_validator.py` (回测验证)
  - 新增`src/analysis/model_optimizer.py` (模型优化)
- **数据层扩展**: 
  - `src/data/sector_fetcher.py` (板块数据获取)
  - `src/data/technical_calculator.py` (技术指标计算)
  - `src/data/historical_validator.py` (历史数据验证)
- **缓存策略**: 
  - 板块数据: `sector_data_{sector_name}_{date_range}`
  - 筛选结果: `sector_screening_{date}`
  - 技术指标: `technical_indicators_{sector_name}_{date}`
  - 回测结果: `backtest_results_{start_date}_{end_date}`
  - 模型参数: `model_parameters_{version}_{date}`
- **配置管理**: `src/config/settings.py`新增板块分析、筛选和回测配置
- **测试覆盖**: 新增板块筛选、分析、回测验证相关测试用例

### 实施顺序
1. **第一阶段**: 实现板块筛选功能，输出Top5推荐板块
2. **第二阶段**: 实现单板块详细分析功能  
3. **第三阶段**: 实现回测验证功能，验证预测准确性
4. **第四阶段**: 实现模型优化功能，形成持续改进闭环
5. **第五阶段**: 整合所有功能，提供完整的板块投资决策支持系统

## 与现有功能的关系
- **兼容性**: 保持现有个股分析功能不变
- **代码复用**: 复用缓存管理、LLM分析、报告生成等模块
- **架构一致性**: 遵循现有模块化架构和编码规范